# Проектная работа "Веб-ларек"

Ссылка на работу для скачивания: https://github.com/jkot1800/web-larek-frontend.git

Интернет - магазин товаров для разработчиков. Проект призван попрактиковаться в освоение TypeScript и ООП. В этом интернет магазине можно выбрать понравившийся вам товар, ознакомиться с описанием, добавить его в корзину и оформить заказ.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Документация
### Описание данных
Для того, чтобы описать данные, которые используются в нашем проекте, было создано несколько интерфейсов.

Интерфейс конкретного товара
```
nterface IProductItem {
	// id товара
	id: string;
	// Описание товара
	description: string;
	// Изображение товара
	image: string;
	// Заголовок с названием товара
	title: string;
	// Категория товара
	category: string;
	// Цена товара
	price: number | null;
}
```

Интерфейс массива с товарами
```
interface IProductList {
	// массив с товарами
	items: IProductItem[];
}
```

Интерфейс формы заказа (Описываются данные, которые введет пользователь в формы)
```
interface IOrderForm {
	// Способ оплаты
	payment: string;
	// Электронная почта
	email: string;
	// Телефон
	phone: string;
	// Адрес
	adress: string;
	// Общая сумма заказа
	total: number | string;
}
```

Интерфейс объекта с массивом с выбранными и добавленными в корзину товарами (В массиве храняться ID выбранных в корзину товаров)
```
interface IOrder extends IOrderForm {
    items: string[];
}
```

Интерфейс состояния приложения (это интерфейс объекта, который хранит данные приложения)
```
interface IAppState {
    interface IAppState {
	// Список товаров с сервера
    catalog: IProductItem[];
	// Данные товара, добавленного в корзину
    basket: string[];
	// Данные товара, который открыт в превью
    preview: string;
	// Данные заказа, отправляемого на сервер
    order: IOrder;
	// Общая сумма товаров
    total: string | number;
}
}
```

Интерфейс объекта с результатами заказа (Информация, которую отдаст сервер после получения заказа)
```
interface IOrderResult {
    /* id заказа */
    id: string;
    /* сумма заказа */
	total: number | string;
}
```

Тип для ошибок валидации
```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Подход к разработке
В проекте используется модель MVP(Model - View - Presenter). Приложение разделено на модули, каждый из которых отвечает за свою часть работы.


### Базовые классы (базовый код):
Базовый код представлен несколькими классами, которые храняться в папке 'src/compronents/base'.

#### Класс **Api** 
Предназначен для работы с Api. Класс хранит базовый Url и опции для сервера при иницилизации нового объекта класса. Имеет методы get(url:string){} и post(url: string, data: object){}. Первый метод get отправляет запрос на сервер и получает объект или массив объектов с запрашиваемыми данными, а метод Post отправляет данные на сервер и получает ответ. 

#### Класс **Component** 
Предназначен для работы с версткой. 
Методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) {} - переключает класс у элемента,
- setTex(element: HTMLElement, value: unknown) {} - устанавливает текстовое содержимое,
- setDisabled(element: HTMLElement, state: boolean) {} - меняет статус блокировки,
- setHidden(element: HTMLElement) {} - скрывает элемент,
- setVisible(element: HTMLElement) {} - показывает элемент,
- setImag(element: HTMLImageElement, src: string, alt?: string) {} - устанавливает изображение и alt,
- render(data?: Partial<T>) {} - обновляет интерфейс(возвращает корневой Dom - элемент).

#### Класс **EventEmitter** 
Брокер событий, который соединяет модели(Model) и представление(View). Обрабатывает и передает события. Реализует следующий интерфейс
```
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```
В конструкторе класса EventEmitter инициализируется структура данных _events. Она представляет из себя объект с коллекцией ключ/значение. В качестве ключа выступают имена событий (EventName), а в качестве значений множетсво подписчики (Set<Subscriber>).
Класс EventEnitter включает в себя следующие методы:
- Метод on(){} устанавливает обработчик на событие. Принимает имя события и колбэк, который будет вызван при возникновении события.
- Метод off(){} снимает обработчик. Принимает имя события и колбэк, который был вызван в on(){}.
- Метод emit(){} создает событие с переданным ему именем(eventName) и необязательными данными(data), вызывает все установленные обработчики на переданное событие.
- Метод onAll(){} устанавливает обработчик на все события. В качестве аргумента передается колбэк, который срабатывает при возникновении любого события.
- Метод ofAll(){} снимает все установленные обработчики событий.
- Метод trigger(){} возвращает функцию-триггер, которая генерирует заданное событие(context).

#### Класс **Model**
Абстрактный класс для моделей в приложении. Принимает необязательные данные data в конструкторе.
Содержит метод emitChanges(), который уведомляет об изменении в модели. Принимает имя события и необязательные данные, которые передаются вместе с событием.


## Слой Model
В слое Model находяться объекты, которые отвечают за бизнес - логику приложения, эти объекты хранят в себе данные, которые получают с сервера и из слоя View(данные товара и данные покупателя). Также эти объекты содержат в себе методы для работы с данными. 

#### Сlass Catalog 
Отвечает за работу с каталогом товаров. Расширяет базовый класс Model. Хранит в себе каталог товаров в виде массива с типом объектов IProductItem. 
Методы: 
setCatalog - принимает данные и устанавливает их в массив объекта, отправляет событие об обновлении каталога.

#### Class ProductItem
Отвечает за хранение информации о конкретном товаре. Расширяет базовый класс Model. Класс имплементирован интерфейсом IProduct.

#### Class Basket
Расширяет базовый класс Model. Отвечает за работу с данным корзины. В полях класса хранит массив с товарами, добавленными в корзину.
Методы класса:
addProductToBasket() - добавить товар в корзину;
removeProductFromBasket() - удаляет товар из корзины;
clearBasket() - очищает корзину;
getTotal() - получает общую сумму цен всех товаров в корзине;
getproductsId() - получает массив с Id товаров, добавленных в корзину(для передачи на сервер).
getProductList() - Получает данные о всех товарах, добавленных в корзину и создает событие, которое сигнализирует об изменении в корзине и передает данные из корзины вместе с событием.
makeOrder() - метод для оформления заказа. Осуществляет проверку товаров и создает одноименное событие.
changeProductList() - когда изменяются данные в корзине, вызывется этот метод, который создает событие изменения в корзине.

#### Сlass Order 
Расширяет базовый класс Model. Имплементирует интерфейс IOrder и принимает такие же поля, как описаны в интерфейсе.
Методы: 
setDeliveryField - устанавливает значения в поля способа оплаты и адреса доставки. Осуществляет валидацию данных с помошью специального метода validationDelivery. Если проверка на валидацию прошла успешно, метод создает событие и передает в него экземпляр класса.
setContactsField - устанавливает значения в в поля Email и телефон. Осуществляет валидацию данных с помошью validationContacts. Если проверка прошла успешно, создает событие и передает экземпляр класса.


## Слой View
В слое View находяться объекты, которые отвечают за отображение. Они содержат в себе методы, которые работают с версткой, изменяют, добавляют, удаляют классы. Также эти объекты работают с модальными окнами, с формами.

### Общие компоненты слоя View

#### Class Modal
Отвечает за работу модального окна. Расширяет базовый класс Component. 

Поля:
closeButton - элемент кнопки закрытия модального окна;
content - разметка контейнера для контента модального окна;

Конструктор принимает container типа HTMLElement и объект с событием, сохраняет элементы разметки в поля класса, передает container в родительский конструктор, вешает слушатели на кнопки.

Методы:
set content() - устанавливает контент в модальном окне;
open() - открывает модальное окно;
close() - закрывает модальное окно;
render() - отрисовывает контент и открывает модальное окно;

#### Class Form<T>
Класс Form отвечает за работу с формой и за валидацию данных в форме. Класс расширяется базовым классом Component.

Конструктор принимает container типа HTMLElement и объект с событием. Сохраняет элементы в разметке полей класса. Устанавливает слушатели на container. 

Поля класса:
_submit - разметка кнопки отправки формы
_errors - разметка ошибок валидации
Методы класса:
onInputChange() - регистрирует событие с именем конкретного поля
set erors() - метод установки ошибок
set valid() - метод установки валидности кнопки отправки данных
render() - отрисовывает форму со всеми элементами


### Классы слоя View

#### Class CardView
Класс предназначен для отображения карточки товара на странице. Расширяет базовый класс Component. 
В полях класс хранит HTML элементы разметки карточки товара. 
CategoryCardElement;
titleCardElement;
imageCardElement;
priceCardElement;

В конструктор принимает Container типа HTMLElement и необязательный объект события.

Методы класса: 
set Category() - устанавливает содержимое категории;
set Title() - устанавливает заголовок;
set Image() - устанавливает изображение товара;
set Price() - устанавливает содержимое цены;
set Description() - устанавливает содержимое описания


#### Class CardPreview
Класс предназначен для вывода данных карточки товара в превью(Модальном окне). Наследует поля и методы от класса Card.
Поля класса отвечают за связь с разметкой.
В классе добавляется поле descriptionCard Element.

Конструктор принимает container типа HTMLElement и необязательный объект события.

В класс добавляются следующие методы:
setButtonStatus() - Проверяет, находится ли товар в корзине. Если товар находится в корзине, то кнопка станет 'Убрать из корзины', если товара в корзине нету, кнопка станет 'В корзину'.


#### Class PageView
Класс отвечает за отображение элементов на главной странице, а также за управление этими элементами. Расширяет класс Component. 
В полях класса хранит следующие элементы:
basketCounter - Html элемент счетчика корзины на главной странице;
basketButtonElement - Html элемент кнопки открытия корзины на главной странице;
catalogElement - Html элемент каталога на главной странице;

В конструкторе ставится слушатель события на кнопку корзины и в случае ее открытия, создается событие, сигнализирующее об открытии корзины. Также в конструктор передается HTMLElement container.

Методы класса:
set catalog() - для установки каталога товаров;
set basketCountNumber() - для установки количества товаров в корзине;


#### Class BasketView
Класс отвечает за отображение корзины. Расширяет класс Component. Конструктор принимает container типа HTMLElement и объект события. Конструктор объявляет список товаров, добавленных в корзину и общую сумму цен этих товаров, также объявляется кнопка 'Оформить', на которую вешается слушатель события перехода в модальное окно оформления.
set products() - устанавливает список товаров в корзине;
set totalAmount() - устанавливает общую сумму заказа в корзине; 


#### Class OrderDeliveryFormView
Отвечает за отображение первого шага заказа в модальном окне (выбор способа оплаты и указания адреса доставки).
Наследует свойства и методы класса Form<T>. 

Поля:
_buttons - разметка кнопок с формами оплаты.

Конструктор принимает container: HTMLElement и объект с событием. Передает container и событие в родительский конструктор, сохраняет нужные элементы разметки в поля класса. Вешает слушатель на кнопку оплаты. с которым работает сеттер payment.

Методы:
set payment - устанавливает класс на активную кнопку;
set adress - устанавливает значение поля адрес;


#### Class OrderContactFormView
Класс отвечает за отображение второго шага формы оплаты в модальном окне. Наследует свойства и методы класса Form<T>. 

Конструктор принимает container: HTMLElement и объект с событием. Передает container и событие в родительский конструктор.

Методы класса: 
set phone - устанавливает значение в поле телефона;
set email - устанавливает значение в поле email.


#### Class OrderSuccessView
Класс отвечает за вывод модального окна об успешном заказе. Наследует свойства и методы от класса Component.

Поля:
_total - разметка с общей суммой цен товаров в заказе;
_close - разметка с кнопкой закрытия окна.

Конструктор принимает container: HTMLElement и объект с событием. Передает container в родительский конструктор и сохраняет элементы разметки в поля. Если объект слушателя был передан, то вешает этот слушатель на кнопку закрытия окна

Методы:
set total - устанавливает значение общей суммы цен в сделанном заказе.



## Слой Presenter
В слое Presenter находится связующая часть между объектами Model и View. Код в Presener не будет выделен в отдельную часть, а будет размещен в основном скрипте приложения index.ts


